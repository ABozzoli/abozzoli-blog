---
import { getCollection } from "astro:content";
import ArticleCard from "../../components/ArticleCard.astro";
import MainLayout from "../../layouts/MainLayout.astro";
import type { GetStaticPaths } from "astro";
import Pagination from "../../components/Pagination.astro";
import Spacer from "../../components/Spacer.astro";
import TagCloud from "../../components/TagCloud.astro";
import { sortByDate } from "../../js/utils";

export const getStaticPaths = (async ({ paginate }) => {
  const articles = await getCollection("blog", ({ data }) => {
    return data.draft !== true;
  });
  sortByDate(articles);

  const pages = paginate(articles, { pageSize: 2 });
  return pages;
}) satisfies GetStaticPaths; /* https://github.com/withastro/astro/issues/6507#issuecomment-1489916992 */

const { page } = Astro.props;
console.log("ðŸš€ ~ page:", { ...page, data: null });

const title = "Blog";
---

<MainLayout {title}>
  <h1 id="page-title">{title}</h1>
  <ul class="card-stack" role="list" aria-labelledby="page-title">
    {page.data.map((article, index) => <ArticleCard {article} {index} {page} hLevel="h3" />)}
  </ul>

  <!-- TODO: hide spacer if there's no pagination -->
  <Spacer height="2rem" />
  <Pagination {page} />

  <Spacer height="2rem" />
  <TagCloud />
</MainLayout>
